<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <title>言語理論とコンパイラ: 第五回: flex の演習</title>
  <meta name="generator" content="amaya 9.5, see http://www.w3.org/Amaya/" />
  <link href="../../stylesheets/slide-screen.css" rel="stylesheet"
  type="text/css" media="screen" />
  <link href="../../stylesheets/slide-proj.css" rel="stylesheet"
  type="text/css" media="projection" />
  <link href="../../stylesheets/slide-print.css" rel="stylesheet"
  type="text/css" media="print" />
  <style type="text/css">
    </style>
</head>

<body>
<h1
style="text-align: center"><strong>言語理論とコンパイラ</strong></h1>

<p style="text-align: center"><strong>第五</strong><strong>回:</strong>
中間テスト、flex の演習</p>

<p style="text-align: center">2006年 5月 26日</p>

<p class="letterhead"><a href="http://www.aoyama.ac.jp/"><img alt="AGU"
src="../../stylesheets/aoyamalogo.jpg" /></a></p>

<p class="signature">© 2005 <a href="mailto:duerst@it.aoyama.ac.jp">Martin
J. Dürst</a> <a href="http://www.aoyama.ac.jp/">青山学院大学</a></p>

<h1>今日の内容</h1>
<ul>
  <li>中間テスト</li>
  <li>flex の使い方と演習</li>
</ul>

<h1>cygwin の使い方</h1>
<ul>
  <li><code>ls</code>: ディレクトリの内容をリストアップ</li>
  <li><code>mkdir</code>: 新しいディレクトリを作る</li>
  <li><code>cd</code>: 現在のディレクトリを変更する</li>
  <li><code>pwd</code>: 現在のディレクトリを表示する</li>
  <li><code>gcc</code>: C のプログラムをコンパイルする</li>
  <li><code>./a</code>:
  コンパイルしたプログラムを実行する</li>
  <li><code>notepad filename.l &amp;</code>: cygwin
    からメモ帳を直接、しかも並行に使える用に立ち上げる</li>
</ul>

<h1>cygwin がハードディスクをどう見ているか</h1>

<p>cygwin のインストール先が例えば <code>C:\cygwin</code>
だとすると、cygwin はまずそこの下しか見せない。</p>

<p>ユーザ用のホームディレクトリは
<code>C:\cygwin\home\user1</code> とかで、<code>pwd</code> で
<code>/home/user1</code> として表示される。</p>

<p><code>C:\cygwin</code> の下から脱出したい場合には <code>cd
/cygdrive/c</code> でできます。</p>

<p>(昔は <code>cygdrive</code>
は秘密でしたが、最近は見えるようになりました)</p>

<h1>flex の使い方 (1)</h1>
<ul>
  <li>拡張子 <code>.l</code> で終わる flex 入力ファイルを作る
    (例: test.l)</li>
  <li>flex で test.l ファイルから lex.yy.c ファイルを作る:<br />
    &gt;<code>flex test.l</code></li>
  <li>lex.yy.c を (他のファイルと一緒に) コンパイルする</li>
</ul>

<h1>flex の使い方 (2)</h1>
<ul>
  <li>独自のファイル処理に使う
    (正規表現によるファイルの一部の認識・変更):
    <p><code>main</code> から <code>yylex()</code> 関数を一回呼ぶ</p>
  </li>
  <li>構文解析から使う:
    <p>構文解析から <code>yylex()</code>
    を繰り返し読んで、トーケンを返すようにする</p>
  </li>
</ul>

<h1>flex の勉強の仕方</h1>
<ul>
  <li>マニュアルを読む: <a
    href="http://www.gnu.org/software/flex/manual/html_mono/flex.html">英語</a>、<a
    href="http://www.gnu.org/software/flex/manual/html_mono/flex.html">日本語</a></li>
  <li>flex の出力 (lex.yy.c) を読む</li>
  <li>違う入力に対する flex の出力を比較</li>
  <li>flex のソースを読む (flex そのものの字句解析は flex
    形式で書かれている)</li>
</ul>

<h1>flex の入力の形式</h1>

<p>flex 専用の指示と C
プログラムの一部の部分が両方ある</p>

<p>主に、二つの <code>%%</code>
で区切られている三つの部分からなる:</p>
<ul>
  <li>前文
  (変数の定義と初期化、良く使う字句の定義など)</li>
  <li>字句規則とその場合に実行するプログラムの部分</li>
  <li>そのほかの関数など</li>
</ul>

<h1>flex の入力の形式の一例</h1>
<pre>        int num_lines = 0, num_chars = 0;
%%
\n      ++num_lines; ++num_chars;
.       ++num_chars;
%%
main()
{
        yylex();
        printf( "# of lines = %d, # of chars = %d\n",
                num_lines, num_chars );
}

int yywrap () { return 1; }</pre>

<h1>flex の演習 1</h1>

<p>前のスライドの flex
用プログラムをファイルに入力して、flex と gcc
を使って実効ファイルにして、試してみてください。</p>

<h1>flex の演習 2</h1>

<p>一般のテキストを XML
の要素の内容に入れたい場合には次の変換を行う必要がある。flex
でその変換と逆変換を行うプログラムをそれぞろ書け。対応表は以下の通り:</p>

<table border="1">
  <tbody>
    <tr>
      <td>テキスト</td>
      <td>XML</td>
    </tr>
    <tr>
      <td><code>'</code></td>
      <td><code>&amp;apos;</code></td>
    </tr>
    <tr>
      <td><code>"</code></td>
      <td><code>&amp;quot;</code></td>
    </tr>
    <tr>
      <td><code>&amp;</code></td>
      <td><code>&amp;amp;</code></td>
    </tr>
    <tr>
      <td><code>&lt;</code></td>
      <td><code>&amp;lt;</code></td>
    </tr>
    <tr>
      <td><code>&gt;</code></td>
      <td><code>&amp;gt;</code></td>
    </tr>
  </tbody>
</table>

<h1>flex の演習 3</h1>

<p>(flex の入力になる <code>.l</code> のファイルを 6月 2日
(金)
11:00時まで提出。名前、学生番号はコメントとして書く。2ページまでの場合、表と裏に印刷。3ページ以上の場合、ホチキスで止める)</p>

<p>一般の XML
ファイルを入力して、その中のものを一行ずつ分かりやすいように書き出す。</p>

<p>例: (入力は &lt;letter&gt;Hello World!&lt;/letter&gt; の場合)</p>

<p>開始タグ: &lt;letter&gt;</p>

<p>要素の内容: Hello World!</p>

<p>終了タグ: &lt;/letter&gt;</p>

<p>ヒント:</p>
<ul>
  <li>入力は半角英語に限る。</li>
  <li>属性は発展問題。</li>
  <li>コメント、処理命令、などは是非やってください。</li>
  <li>要素の入れ子構造は出力でも見えるようにしてください。</li>
  <li>終わりに閉じてない要素がありましたら警告を出してください。</li>
</ul>
</body>
</html>
